<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Map with Points of Interest</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
        }
        .mapboxgl-popup-content img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'racheldennis.ggg80i13';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12', // Mapbox style
            center: [4.814953, 52.340589], // [longitude, latitude] of parkCenter
            zoom: 16,
            pitch: 60, // Tilt the map for 3D effect
            bearing: -60 // Rotate the map
        });

        // Add zoom and rotation controls to the map
        map.addControl(new mapboxgl.NavigationControl());

        // Add 3D buildings layer
        map.on('load', function () {
            // Insert the layer beneath any symbol layer.
            const layers = map.getStyle().layers;
            let labelLayerId;
            for (let i = 0; i < layers.length; i++) {
                if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
                    labelLayerId = layers[i].id;
                    break;
                }
            }

            map.addLayer({
                'id': '3d-buildings',
                'source': 'composite',
                'source-layer': 'building',
                'filter': ['==', 'extrude', 'true'],
                'type': 'fill-extrusion',
                'minzoom': 15,
                'paint': {
                    'fill-extrusion-color': '#aaa',
                    'fill-extrusion-height': [
                        'interpolate', ['linear'], ['zoom'],
                        15, 0,
                        15.05, ['get', 'height']
                    ],
                    'fill-extrusion-base': [
                        'interpolate', ['linear'], ['zoom'],
                        15, 0,
                        15.05, ['get', 'min_height']
                    ],
                    'fill-extrusion-opacity': 0.6
                }
            }, labelLayerId);
        });

        // Define the points of interest with image and description
        const pointsOfInterest = [
            {
                name: "Point of Interest 1",
                coordinates: [4.814967357627049, 52.34068518349773],
                description: "This is the first point of interest in Amsterdamse Bos.",
                image: "https://via.placeholder.com/300x200.png?text=Point+1"
            },
            {
                name: "Point of Interest 2",
                coordinates: [4.816352161023659, 52.3408081232501],
                description: "This is the second point of interest in Amsterdamse Bos.",
                image: "https://via.placeholder.com/300x200.png?text=Point+2"
            },
            {
                name: "Point of Interest 3",
                coordinates: [4.813434012011979, 52.341420489919074],
                description: "This is the third point of interest in Amsterdamse Bos.",
                image: "https://via.placeholder.com/300x200.png?text=Point+3"
            },
            {
                name: "Point of Interest 4",
                coordinates: [4.814033551508082, 52.34023125357226],
                description: "This is the fourth point of interest in Amsterdamse Bos.",
                image: "https://via.placeholder.com/300x200.png?text=Point+4"
            }
        ];

        // Add markers to the map for each point of interest
        pointsOfInterest.forEach(poi => {
            const el = document.createElement('div');
            el.className = 'marker';

            new mapboxgl.Marker(el)
                .setLngLat(poi.coordinates)
                .setPopup(new mapboxgl.Popup({ offset: 25 }) // Add popups
                    .setHTML(`
                        <h3>${poi.name}</h3>
                        <img src="${poi.image}" alt="${poi.name}">
                        <p>${poi.description}</p>
                    `))
                .addTo(map);
        });

        // Event listener for adding new points
        map.on('click', function (e) {
            const coordinates = e.lngLat;
            const name = prompt("Enter the name for this point:");
            const description = prompt("Enter a description for this point:");
            const imageUrl = prompt("Enter the image URL for this point:");

            if (name && description && imageUrl) {
                const newPoi = {
                    name: name,
                    coordinates: [coordinates.lng, coordinates.lat],
                    description: description,
                    image: imageUrl
                };

                pointsOfInterest.push(newPoi);

                new mapboxgl.Marker()
                    .setLngLat(newPoi.coordinates)
                    .setPopup(new mapboxgl.Popup({ offset: 25 })
                        .setHTML(`
                            <h3>${newPoi.name}</h3>
                            <img src="${newPoi.image}" alt="${newPoi.name}">
                            <p>${newPoi.description}</p>
                        `))
                    .addTo(map);
            }
        });
    </script>
</body>
</html>
